#!/usr/bin/env bash

# Check if the ssh-agent is already running
#if [[ "$(ps -u "${USER}" | grep -c ssh-agent)" -lt "1" ]]; then
if [[ "$(ps -u "${USER}" | grep -c ssh-agent)" -lt "2" ]]; then
    # echo "$(date +%F@%T) - SSH-AGENT: Agent will be started"
    # Start the ssh-agent and redirect the environment variables into a file
    ssh-agent -s >~/.ssh/ssh-agent
    # Load the environment variables from the file
    . ~/.ssh/ssh-agent >/dev/null
    # Add the default key to the ssh-agent
    ssh-add ~/.ssh/id_rsa
else
    #echo "$(date +%F@%T) - SSH-AGENT: Agent already running"
    . ~/.ssh/ssh-agent >/dev/null
fi

# Enable tab completion of Python virtual environments
if [ -f /opt/_venv-activate/_venv-activate.sh ]; then
    _VENV_ACTIVATE_HOME="${HOME}/.venvs"
    _VENV_ACTIVATE_PYTHON=$(which python3)
    . /opt/_venv-activate/_venv-activate.sh
fi

# Added by cpan
if [ -d "/home/${USER}/perl5" ]; then
    PATH="/home/${USER}/perl5/bin${PATH:+:${PATH}}"; export PATH;
    PERL5LIB="/home/${USER}/perl5/lib/perl5${PERL5LIB:+:${PERL5LIB}}"; export PERL5LIB;
    PERL_LOCAL_LIB_ROOT="/home/${USER}/perl5${PERL_LOCAL_LIB_ROOT:+:${PERL_LOCAL_LIB_ROOT}}"; export PERL_LOCAL_LIB_ROOT;
    PERL_MB_OPT="--install_base \"/home/${USER}/perl5\""; export PERL_MB_OPT;
    PERL_MM_OPT="INSTALL_BASE=/home/${USER}/perl5"; export PERL_MM_OPT;
fi

# Add GPG key
export GPG_TTY=$(tty)
